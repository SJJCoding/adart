(this.webpackJsonpstreamlit_img_label=this.webpackJsonpstreamlit_img_label||[]).push([[0],{27:function(e,t){},28:function(e,t){},29:function(e,t){},31:function(e,t,a){"use strict";a.r(t);var n=a(3),i=a.n(n),o=a(14),r=a.n(o),c=a(0),s=a(2),l=a(1),d=a(12),f=a(6),h=a(8),b=a.n(h),u=a(5);function g(e,t){var a=new Path2D,n=e[0];a.moveTo(n[0]+t,n[1]);for(var i=1;i<e.length-2;i++){var o=e[i],r=e[i+1],c=[o[0]+(r[0]-o[0])/2,o[1]+(r[1]-o[1])/2];a.arcTo(c[0],c[1],r[0]+t,r[1],t)}var s=e[e.length-2],l=e[e.length-1];return a.lineTo(l[0],l[1]),a.lineTo(s[0],s[1]),a.arcTo(l[0]-t,l[1],l[0]-t,l[1]+t,t),a.arcTo(l[0]-t,l[1]+2*t,l[0],l[1]+2*t,t),a.arcTo(l[0]+t,l[1]+2*t,l[0]+t,l[1]+t,t),a.arcTo(l[0]+t,l[1],l[0],l[1],t),a.closePath(),a.toString()}var m=Object(d.b)((function(e){var t,a=Object(n.useState)("light"),i=Object(l.a)(a,2),o=i[0],r=i[1],h=Object(n.useState)([]),m=Object(l.a)(h,2),k=m[0],p=m[1],j=Object(n.useState)(new f.fabric.Canvas("")),v=Object(l.a)(j,2),O=v[0],w=v[1],x=e.args,T=x.canvasWidth,S=x.canvasHeight,C=x.shapes,y=x.boxColor,R=x.imageData,E=Object(n.useState)(0),W=Object(l.a)(E,2),P=W[0],I=W[1],L=document.createElement("canvas"),U=L.getContext("2d");if(L.width=T,L.height=S,U){var _=U.createImageData(T,S);_.data.set(R),U.putImageData(_,0,0),t=L.toDataURL()}else t="";Object(n.useEffect)((function(){var e=new f.fabric.Canvas("c",{enableRetinaScaling:!1,backgroundImage:t,uniScaleTransform:!0});w(e)}),[t]),Object(n.useEffect)((function(){if(O){var t=e.args,a=t.shapes,n=t.boxColor;a.forEach((function(e){if("rectangle"===e.shapeType){var t=e.top,a=e.left,i=e.width,o=e.height,r=e.label;console.log("rendering rectangle"),console.log(e),O.add(new f.fabric.Rect({left:a,top:t,fill:"",width:i,height:o,objectCaching:!0,stroke:n,strokeWidth:1,strokeUniform:!0,hasRotatingPoint:!1})),O.add(new f.fabric.Text(r,{left:a,top:t+20,fontFamily:"Arial",fontSize:14,fontWeight:"bold",fill:n}))}else{if("spline"!==e.shapeType)return void console.warn('Invalid shape "'.concat(e,'" specified". Skipping...'));var c=e.points,s=(e.radius,e.label),l=new f.fabric.Path(g(e.points.map((function(e){return[e.x,e.y]})),e.radius),{fill:"",stroke:n,strokeWidth:1,strokeUniform:!0,hasRotatingPoint:!1});O.add(l),O.add(new f.fabric.Text(s,{left:c[0].x,top:c[0].y-20,fontFamily:"Arial",fontSize:14,fontWeight:"bold",fill:n}))}}))}p(C.map((function(e){return e.label}))),d.a.setFrameHeight()}),[O,S,T,R,C,y]);var A=function(){I(0),O.getObjects().forEach((function(e){return O.remove(e)})),F([])},F=function(e){p(e);var t=O.getObjects().map((function(t,a){return Object(s.a)(Object(s.a)({},t.getBoundingRect()),{},{label:e[a]})}));d.a.setComponentValue({rects:t})};Object(n.useEffect)((function(){if(O){return O.on("object:modified",(function(){O.renderAll(),F(k)})),function(){O.off("object:modified")}}}));var N=function(e){r(e),"dark"===e?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode")};return Object(n.useEffect)((function(){return window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(function(e){return N(e.matches?"dark":"light")})),N(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),function(){window.matchMedia("(prefers-color-scheme: dark)").removeEventListener("change",(function(){}))}}),[]),Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("canvas",{id:"c",className:"dark"===o?b.a.dark:"",width:T,height:S}),Object(u.jsxs)("div",{className:"dark"===o?b.a.dark:"",children:[Object(u.jsx)("button",{className:"dark"===o?b.a.dark:"",onClick:function(){var t={left:.15*T+3*P,top:.15*S+3*P,width:.2*T,height:.2*S};I(P+1),O.add(new f.fabric.Rect(Object(s.a)(Object(s.a)({},t),{},{fill:"",objectCaching:!0,stroke:e.args.boxColor,strokeWidth:1,strokeUniform:!0,hasRotatingPoint:!1}))),F([].concat(Object(c.a)(k),[""]))},children:"Mark Untagged"}),Object(u.jsx)("button",{className:"dark"===o?b.a.dark:"",onClick:function(){var e=O.getActiveObject(),t=O.getObjects().indexOf(e);O.remove(e),F(k.filter((function(e,a){return a!==t})))},children:"Remove select"}),Object(u.jsx)("button",{className:"dark"===o?b.a.dark:"",onClick:function(){A();var e=new f.fabric.Canvas("c",{enableRetinaScaling:!1,backgroundImage:t,uniScaleTransform:!0});C.forEach((function(t){if("rectangle"===t.shapeType){var a=t.top,n=t.left,i=t.width,o=t.height,r=t.label;e.add(new f.fabric.Rect({left:n,top:a,fill:"",width:i,height:o,objectCaching:!0,stroke:y,strokeWidth:1,strokeUniform:!0,hasRotatingPoint:!1})),e.add(new f.fabric.Text(r,{left:n,top:a+20,fontFamily:"Arial",fontSize:14,fontWeight:"bold",fill:y}))}else{if("spline"!==t.shapeType)return void console.warn('Invalid shape "'.concat(t,'" specified". Skipping...'));var c=t.points,s=(t.radius,t.label),l=new f.fabric.Path(g(t.points.map((function(e){return[e.x,e.y]})),t.radius),{fill:"",stroke:y,strokeWidth:1,strokeUniform:!0,hasRotatingPoint:!1});e.add(l),e.add(new f.fabric.Text(s,{left:c[0].x,top:c[0].y-20,fontFamily:"Arial",fontSize:14,fontWeight:"bold",fill:y}))}})),F(k)},children:"Reset"}),Object(u.jsx)("button",{className:"dark"===o?b.a.dark:"",onClick:A,children:"Clear all"})]})]})}));r.a.render(Object(u.jsx)(i.a.StrictMode,{children:Object(u.jsx)(m,{})}),document.getElementById("root"))},8:function(e,t,a){e.exports={dark:"StreamlitImgLabel_dark__1ucLf"}}},[[31,1,2]]]);
//# sourceMappingURL=main.cbdac199.chunk.js.map